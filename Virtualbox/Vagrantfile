# -*- mode: ruby -*- # optional, tells editors this is Ruby
# Vagrantfile for a clean Ubuntu 20.04 VM with an extra 10 GB SATA disk

Vagrant.configure("2") do |config|
  # ------------------------------------------------------------
  # 1️⃣  Basic VM definition
  # ------------------------------------------------------------
  config.vm.box = "ubuntu/jammy64"
  config.vm.hostname = "dst-linux-disk"

  # ------------------------------------------------------------
  # 2️⃣  VirtualBox provider – custom storage
  # ------------------------------------------------------------
  config.vm.provider "virtualbox" do |vb|
    vb.memory = 1024   # 1 GB – just to be explicit
    # ---- 2a. Create a SATA controller (IntelAhci)
    vb.customize [
      "storagectl", :id,
      "--name", "SATA Controller",
      "--add", "sata",
      "--controller", "IntelAhci"
    ]

    # ---- 2b. Path for the new VDI
    disk_name = "exp_disk.vdi"
    disk_path = File.expand_path(disk_name, __dir__)  # e.g. /home/ubuntu/.../Virtualbox/exp_disk.vdi

    # ---- 2c. Create the disk (10 GB)
    vb.customize [
      "createhd",
      "--filename", disk_path,
      "--size", "10240",      # 10 GB (1024 × 10)
      "--format", "VDI",
      "--variant", "Standard"
    ]

    # ---- 2d. Attach the disk to the controller
    vb.customize [
      "storageattach", :id,
      "--storagectl", "SATA Controller",
      "--port", 1,
      "--device", 0,
      "--type", "hdd",
      "--medium", disk_path
    ]
  end

  # ------------------------------------------------------------
  # 3️⃣  Optional: synced folder (you can adjust as needed)
  # ------------------------------------------------------------
  config.vm.synced_folder ".", "/vagrant", disabled: false

  # ------------------------------------------------------------
  # 4️⃣  Optional: forwarded port for SSH (default is 2222)
  # ------------------------------------------------------------
  config.vm.network "forwarded_port", guest: 22, host: 2222

  # ------------------------------------------------------------
  # 5️⃣  Optional: provision script (e.g., install packages)
  # ------------------------------------------------------------
  config.vm.provision "shell", inline: <<-SHELL
    # Example: Update & install curl
    sudo apt-get update -y
    sudo apt-get install -y curl
  SHELL
end
